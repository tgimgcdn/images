# 构建一套图床系统
 - Github仓库：存放前端系统源码和图片文件
 - CloudFlare Pages项目：部署前端系统，提供图片访问
 - CloudFlare D1：存储图片元数据

## 系统架构
1. Github仓库
   - 根目录存放前端系统源码
   - `/images` 目录存放上传的图片文件
   - 通过 GitHub API 实现图片上传

2. CloudFlare Pages项目
   - 部署前端系统
   - 自动从 GitHub 仓库拉取最新代码和图片
   - 通过 CloudFlare 的全球 CDN 提供快速访问
   - 绑定自定义域名，通过 https://自定义域名/images/xx.jpg 访问图片
   - 集成 CloudFlare D1 数据库

3. CloudFlare D1
   - 存储图片元数据（名称、大小、创建时间、访问次数等）
   - 支持 SQL 查询，实现高效的列表和搜索功能
   - 免费版本提供：
     - 10GB 存储空间
     - 每天 1000 万行读取
     - 每天 1000 万行写入
     - 每天 1000 万行删除
   - 支持图片访问统计
   - 支持按时间、大小等条件筛选

## 环境变量配置
在 CloudFlare Pages 项目设置中配置以下环境变量：

1. GitHub 相关
   - `GITHUB_TOKEN`: GitHub 个人访问令牌，用于上传文件
   - `GITHUB_OWNER`: GitHub 仓库所有者用户名
   - `GITHUB_REPO`: GitHub 仓库名称

2. 安全相关
   - `SESSION_SECRET`: 会话密钥，用于加密会话数据
   - `RECAPTCHA_SITE_KEY`: reCAPTCHA 站点密钥（用于前端验证，可选）
   - `RECAPTCHA_SECRET_KEY`: reCAPTCHA 密钥（用于后端验证，可选）

3. 站点配置
   - `SITE_URL`: 站点访问地址，例如：`https://example.com`

## 数据库绑定
在 CloudFlare Pages 项目设置中配置以下数据库绑定：

1. D1 数据库
   - 绑定名称: `DB`
   - 数据库名称: `image_hosting`
   - 数据库 ID: 在 CloudFlare D1 中创建数据库后获取

## 数据库初始化
系统首次启动时会自动初始化数据库并创建默认管理员账户：
- 默认管理员用户名: `admin`
- 默认管理员密码: `admin123`

登录验证是通过匹配数据库中的用户信息进行的，而不是环境变量。请在首次登录后立即修改默认密码。

## 前端系统功能
1. 页面布局
   - 顶部居中显示"CloudFlare Pages图床管理系统"
   - 上传区域（占页面2/3宽度）
     - 支持点击选择文件
     - 支持Ctrl+V粘贴
     - 显示选中文件列表（文件名和大小）
     - 显示上传进度条（实时进度和速度）
   - 上传按钮（占页面1/3宽度）

2. 文件管理
   - 显示已有文件列表
   - 列表字段：复选框、序号、文件名、大小、创建时间、操作按钮
   - 鼠标悬停显示图片缩略图
   - 支持文件删除
   - 支持批量操作

## 工作流程
1. 用户通过前端系统上传图片
2. 图片通过 GitHub API 直接上传到仓库的 `/images` 目录
3. CloudFlare Pages 自动检测到更新并重新部署
4. 图片元数据同时写入 CloudFlare D1 数据库
5. 用户可以通过自定义域名访问图片
6. 系统自动记录图片访问统计

## 技术优势
1. 架构简单，易于维护
2. 利用 CloudFlare 全球 CDN 提供快速访问
3. 无需复杂的组件间通信
4. 自动化的部署流程
5. 可靠的数据存储和查询能力
6. 支持图片访问统计和分析
7. 数据库性能满足高并发需求


和cdn-main文件夹里面的系统不一样的是，这个新系统首页就要显示一个漂亮的，整版的上传页面，用于上传图片，上传成功以后显示Markdown html url bbcode的链接给用户，将登录系统移到https://自定义域名/admin/，后台登录以后还要新增一个选择按键，是否开放游客上传，是的话游客可以在首页上传图片，否的话无法上传，后台上传不受影响。
 